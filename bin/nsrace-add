#!/usr/bin/env node

const cli = require("commander")
const assert = require('assert')
const remove = require("just-remove")
const config = require("../lib/config")
const { checkIsServerString } = require("../lib/utils")

const DEFAULT_TYPE = 'dns'

cli
  .option("-t, --type [dns|doh]", `Server type`, DEFAULT_TYPE)
  .parse(process.argv)

assert(['dns', 'doh'].includes(cli.type), 'Invalid type')

const key = `servers.${cli.type}`
const latest = config.get(key) || []
const patch = remove(cli.args, latest).filter((server) =>
  checkIsServerString(server)
)
config.set(key, latest.concat(patch))

console.log(`${patch.length} ${cli.type.toUpperCase()} servers added.`)
